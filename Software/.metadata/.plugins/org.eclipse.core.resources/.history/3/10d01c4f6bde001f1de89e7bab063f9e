#include "main.h"
#include <stdio.h>

#define BMP280_ADDR 0x76 << 1   // Links-Shift wegen HAL (7-Bit-Adresse wird 8-Bit)

I2C_HandleTypeDef hi2c1;

uint8_t BMP280_ReadID() {
    uint8_t reg = 0xD0;  // Register für Chip-ID
    uint8_t id = 0;      // Variable für die ID

    // Register-Adresse senden
    HAL_I2C_Master_Transmit(&hi2c1, BMP280_ADDR, &reg, 1, HAL_MAX_DELAY);

    // Antwort auslesen
    HAL_I2C_Master_Receive(&hi2c1, BMP280_ADDR, &id, 1, HAL_MAX_DELAY);

    return id;
}

void BMP280_Init() {
    uint8_t chip_id = BMP280_ReadID();

    if (chip_id == 0x58) {
        printf("BMP280 erfolgreich erkannt! ID: 0x%x\n", chip_id);
    } else {
        printf("Fehler: BMP280 nicht erkannt! ID: 0x%x\n", chip_id);
    }
}
